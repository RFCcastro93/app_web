{% extends "base.html" %}

{% block title %}Subcontractor{% endblock %}

{% block content %}
<h2>ğŸ”§ ServiÃ§os disponÃ­veis</h2>

<!-- Lista de serviÃ§os -->
{% for s in services %}
  <div class="card" style="margin-bottom:20px;">
    <h3>{{ s.title }}</h3>
    <p>{{ s.description }}</p>
    <p><b>Categoria:</b> {{ s.category }} â€¢ <b>Local:</b> {{ s.location }}</p>
    <p><b>Faixa:</b> {{ s.price_range }}</p>

    <!-- FormulÃ¡rio para enviar lance -->
    <form method="POST" style="margin-top:12px;">
      <input type="hidden" name="service_id" value="{{ s.id }}">
      <input type="number" step="0.01" name="bid" placeholder="Seu lance" required style="width: 100%; padding: 8px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #ccc;">
      <button type="submit" class="button" style="width: 100%;">Enviar Lance</button>
    </form>

    <!-- ExibiÃ§Ã£o do melhor lance -->
    {% if s.winner %}
      {% set w = users_index.get(s.winner_user_id) if s.winner_user_id else None %}
      <div style="margin-top:12px; background-color:#e0f2fe; padding: 8px; border-radius: 8px;">
        <p>ğŸ† Melhor lance atual: <b>${{ '%.2f'|format(s.winner) }}</b></p>
        {% if w %}
          <p><b>Vencedor:</b> {{ w.name }} â€” {{ w.email }}</p>
        {% endif %}
      </div>
    {% endif %}
  </div>
{% else %}
  <p class="muted">Nenhum serviÃ§o publicado no momento.</p>
{% endfor %}

{% endblock %}
